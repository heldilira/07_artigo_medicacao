---
title: "Análises Descritivas do Banco Medicamentos"
format: html
editor: visual
author: 
  - Helder Lira
  - Renatha Rafihi
---

```{r, include=FALSE}
#| label: knitr options
knitr::opts_chunk$set(results = 'asis',
                      echo = FALSE,
                      warning = FALSE,
                      tidy = FALSE,
                      message = FALSE,
                      fig.align = 'center',
                      out.width = "100%")
options(knitr.table.format = "html")
```

```{r}
#| label: import packages

library(kableExtra)
library(tidyverse)
library(easystats)
library(modelsummary)
```

```{r fig-bar_meds_filtered}
#| label: bar_meds_filtered
#| fig.cap: "Os 10 medicamentos mais utilizados pela amostra total"
knitr::include_graphics("img/bar_meds_filtered.png")
```

```{r fig-bar_meds_unfiltered}
#| label: bar_meds_unfiltered
#| fig.cap: "Medicamentos mais utilizados pela amostra total"
knitr::include_graphics("img/bar_meds_unfiltered.png")
```

```{r fig-bar_prop}
#| label: bar_prop
#| fig.cap: "Proporção de uso de medicamentos entre os grupos (Uso Ocasional vs Uso Contínuo)"
knitr::include_graphics("img/bar_prop.png")
```

```{r fig-bar_class_total}
#| label: bar_class_total
#| fig.cap: "Classes de medicamentos mais utilizados"
knitr::include_graphics("img/bar_class_total.png")
```

```{r fig-bar_prop_class}
#| label: bar_prop_class
#| fig.cap: "Proporção das classes de medicamentos entre os grupos (Uso Ocasional vs Uso Contínuo)"
knitr::include_graphics("img/bar_prop_class.png")
```

```{r}
#| label: tabela 1 socio (Uso vs Não Uso) 
#| tab.cap: "Tabela 1 com dados sociodemográficos (Uso vs Não Uso)"

table1 <- readr::read_csv("table_1.csv")

opts <- options(knitr.kable.NA = "")

kable(table1, "html", align = "lccc") |> 
  add_indent(positions = c(3,4,6,7,9,10,12,13,15,16,18:23))
```

```{r}
#| label: tabela 2 (Ocasional vs Contínuo)
#| tab.cap: "Tabela 2 medicamentos (Ocasional vs Contínuo)"

table2 <- readr::read_csv("table_2.csv")

opts <- options(knitr.kable.NA = "")

kable(table2, "html", align = "lccc")
```

```{r}
#| label: Regressão Logística (Não Uso vs Uso)

df_insones <- read_rds(file = "data/df_insones.RDS")

logit_model <- glm(uso_naouso ~ sexo_tr + escolaridade_tr + estado_civil_tr + etnia_tr + atividade_fisica_tr + igi_escore + ehad_ansiedade_escore + ehad_depressao_escore, data = df_insones, family = binomial)

modelsummary(logit_model,
             exponentiate = TRUE,
             stars = c('*' =.05, '**' = .01),
             fmt = 2, 
             estimate = "{estimate}{stars} [{conf.low}, {conf.high}]", statistic = NULL )

levels(df_insones$uso_naouso)
report(logit_model)
check_autocorrelation(logit_model)
check_collinearity(logit_model)
check_model(logit_model)
```
